# Run Application

In previous sections you learned about different  ABCI 2.0 methods and how they are used.

In this section you will learn how to run the `Forum Application`.

## Initializing and Running

The application is almost ready to run, but first we'll need to populate the CometBFT configuration file.

The following command will create a cometbft home directory in your project and add a basic set of configuration
files in ~/config/.

For more information on what these files contain see the [configuration documentation](https://docs.cometbft.com/v1.0/references/config/).

From the root of your project, run:

```go
go run github.com/cometbft/cometbft/cmd/cometbft@v1.0.0-alpha.2 init --home /tmp/forum-app
```

You should see an output similar to the following:

```bash
I[2024-04-23|20:16:43.493] Found private validator                      module=main keyFile=/tmp/forum-app/config/priv_validator_key.json stateFile=/tmp/forum-app/data/priv_validator_state.json
I[2024-04-23|20:16:43.493] Found node key                               module=main path=/tmp/forum-app/config/node_key.json
I[2024-04-23|20:16:43.493] Found genesis file                           module=main path=/tmp/forum-app/config/genesis.json
```

Now rebuild the app (use `-mod=mod` to automatically refresh the dependencies):

```go
go build -mod=mod
```

Everything is now in place to run your application. Run:

```bash
./abci2-forum-app --cmt-home /tmp/forum-app
```

This should start the full node and connect to our ABCI application, which will be reflected in the application output.

```bash
New DB
badger 2024/04/23 16:17:25 INFO: All 0 tables opened in 0s
badger 2024/04/23 16:17:25 INFO: Discard stats nextEmptySlot: 0
badger 2024/04/23 16:17:25 INFO: Set nextTxnTs to 0
I[2024-04-23|20:17:26.027] State store key layout version               version=vv1
I[2024-04-23|20:17:26.037] Blockstore version                           version=v1
I[2024-04-23|20:17:26.037] WARNING: deleting genesis file from database if present, the database stores a hash of the original genesis file now
I[2024-04-23|20:17:26.037] service start                                module=proxy msg="Starting multiAppConn service" impl=multiAppConn
I[2024-04-23|20:17:26.037] service start                                module=abci-client connection=query msg="Starting localClient service" impl=localClient
I[2024-04-23|20:17:26.037] service start                                module=abci-client connection=snapshot msg="Starting localClient service" impl=localClient
I[2024-04-23|20:17:26.037] service start                                module=abci-client connection=mempool msg="Starting localClient service" impl=localClient
I[2024-04-23|20:17:26.037] service start                                module=abci-client connection=consensus msg="Starting localClient service" impl=localClient
I[2024-04-23|20:17:26.037] service start                                module=events msg="Starting EventBus service" impl=EventBus
I[2024-04-23|20:17:26.037] service start                                module=pubsub msg="Starting PubSub service" impl=PubSub
I[2024-04-23|20:17:26.058] service start                                module=txindex msg="Starting IndexerService service" impl=IndexerService
I[2024-04-23|20:17:26.058] ABCI Handshake App Info                      module=consensus height=0 hash=0000000000000000 software-version=2.0.0 protocol-version=1
I[2024-04-23|20:17:26.058] ABCI Replay Blocks                           module=consensus appHeight=0 storeHeight=0 stateHeight=0
Executing Application InitChain
I[2024-04-23|20:17:26.063] Completed ABCI Handshake - CometBFT and App are synced module=consensus appHeight=0 appHash=0000000000000000
I[2024-04-23|20:17:26.063] Version info                                 tendermint_version=1.0.0-alpha.2 abci=2.0.0 block=11 p2p=9 commit_hash=
I[2024-04-23|20:17:26.063] This node is a validator                     module=consensus addr=BBD835B60F18426896E705A1DFD12444D4421C68 pubKey=PubKeyEd25519{3C91B99B7D5A3884B12FD3D929B72659E5F4BA0CF3A2BF6DF051F3943BC39C24}
I[2024-04-23|20:17:26.100] P2P Node ID                                  module=p2p ID=fb9b44bbfe06ffdb97bffe57a80e32d8df140cef file=/tmp/forum-app/config/node_key.json
I[2024-04-23|20:17:26.100] Adding persistent peers                      module=p2p addrs=[]
I[2024-04-23|20:17:26.100] Adding unconditional peer ids                module=p2p ids=[]
I[2024-04-23|20:17:26.100] Add our address to book                      module=p2p book=/tmp/forum-app/config/addrbook.json addr=fb9b44bbfe06ffdb97bffe57a80e32d8df140cef@0.0.0.0:26656
I[2024-04-23|20:17:26.100] service start                                msg="Starting Node service" impl=Node
I[2024-04-23|20:17:26.101] service start                                module=p2p msg="Starting P2P Switch service" impl="P2P Switch"
I[2024-04-23|20:17:26.101] service start                                module=blocksync msg="Starting Reactor service" impl=Reactor
I[2024-04-23|20:17:26.101] serve                                        module=rpc-server msg="Starting RPC HTTP server on 127.0.0.1:26657"
I[2024-04-23|20:17:26.101] service start                                module=consensus msg="Starting Consensus service" impl=ConsensusReactor
I[2024-04-23|20:17:26.101] service start                                module=consensus msg="Starting State service" impl=ConsensusState
I[2024-04-23|20:17:26.102] service start                                module=consensus wal=/tmp/forum-app/data/cs.wal/wal msg="Starting baseWAL service" impl=baseWAL
I[2024-04-23|20:17:26.107] service start                                module=consensus wal=/tmp/forum-app/data/cs.wal/wal msg="Starting Group service" impl=Group
I[2024-04-23|20:17:26.107] service start                                module=consensus msg="Starting TimeoutTicker service" impl=TimeoutTicker
I[2024-04-23|20:17:26.107] Searching for height                         module=consensus wal=/tmp/forum-app/data/cs.wal/wal height=1 min=0 max=0
I[2024-04-23|20:17:26.107] Searching for height                         module=consensus wal=/tmp/forum-app/data/cs.wal/wal height=0 min=0 max=0
I[2024-04-23|20:17:26.107] Found                                        module=consensus wal=/tmp/forum-app/data/cs.wal/wal height=0 index=0
I[2024-04-23|20:17:26.107] Catchup by replaying consensus messages      module=consensus height=1
I[2024-04-23|20:17:26.107] Replay: Done                                 module=consensus
I[2024-04-23|20:17:26.107] service start                                module=evidence msg="Starting Evidence service" impl=Evidence
I[2024-04-23|20:17:26.107] service start                                module=statesync msg="Starting StateSync service" impl=StateSync
I[2024-04-23|20:17:26.107] service start                                module=pex msg="Starting PEX service" impl=PEX
I[2024-04-23|20:17:26.107] service start                                module=p2p book=/tmp/forum-app/config/addrbook.json msg="Starting AddrBook service" impl=AddrBook
I[2024-04-23|20:17:26.107] service start                                module=mempool msg="Starting Mempool service" impl=Mempool
I[2024-04-23|20:17:26.107] Saving AddrBook to file                      module=p2p book=/tmp/forum-app/config/addrbook.json size=0
I[2024-04-23|20:17:26.107] Ensure peers                                 module=pex numOutPeers=0 numInPeers=0 numDialing=0 numToDial=10
I[2024-04-23|20:17:26.108] service start                                module=state msg="Starting Pruner service" impl=Pruner
I[2024-04-23|20:17:26.108] No addresses to dial. Falling back to seeds  module=pex
I[2024-04-23|20:17:26.108] Started pruning blocks                       module=state interval=10s
I[2024-04-23|20:17:27.096] Timed out                                    module=consensus dur=988.244ms height=1 round=0 step=RoundStepNewHeight
Executing Application PrepareProposal
Processed vote extensions : map[]
I[2024-04-23|20:17:27.109] received proposal                            module=consensus proposal="Proposal{1/0 (6E5C9900BE599B3C0BAA73FCAAD238500B7645CEC649A373B03B9C3C618A0335:1:42BD90B66CFF, -1) AC44CBA7A291 @ 2024-04-23T20:06:16.200387Z}" proposer=BBD835B60F18426896E705A1DFD12444D4421C68
I[2024-04-23|20:17:27.113] received complete proposal block             module=consensus height=1 hash=6E5C9900BE599B3C0BAA73FCAAD238500B7645CEC649A373B03B9C3C618A0335
Executing Application ProcessProposal
Executing Application ExtendVote
I[2024-04-23|20:17:27.125] finalizing commit of block                   module=consensus height=1 hash=6E5C9900BE599B3C0BAA73FCAAD238500B7645CEC649A373B03B9C3C618A0335 root=0000000000000000 num_txs=0
Executing Application FinalizeBlock
I[2024-04-23|20:17:27.134] finalized block                              module=state height=1 num_txs_res=0 num_val_updates=0 block_app_hash=0000000000000000
I[2024-04-23|20:17:27.134] executed block                               module=state height=1 app_hash=0000000000000000
Executing Application Commit
&{0x14000506158 0 1}
I[2024-04-23|20:17:27.139] committed state                              module=state height=1 block_app_hash=0000000000000000
I[2024-04-23|20:17:27.150] indexed block events                         module=txindex height=1
I[2024-04-23|20:17:28.125] Timed out                                    module=consensus dur=981.123ms height=2 round=0 step=RoundStepNewHeight
Executing Application PrepareProposal
Processed vote extensions : map[bad:1 bloodmagic:1 cry:1 muggle:1 rain:1]
I[2024-04-23|20:17:28.136] received proposal                            module=consensus proposal="Proposal{2/0 (D5069784C1A47BC356B26ACB4026A87D62BDF956BCD42FE5D65D64302568ECE0:1:5BBA85B19E94, -1) 834F8E22863F @ 2024-04-23T20:17:27.119426Z}" proposer=BBD835B60F18426896E705A1DFD12444D4421C68
```

Also, the application using CometBFT Core is producing blocks ðŸŽ‰ðŸŽ‰ and you can see this reflected in the log output of the service in lines like this:

```bash
I[2024-04-23|20:17:27.109] received proposal                            module=consensus proposal="Proposal{1/0 (6E5C9900BE599B3C0BAA73FCAAD238500B7645CEC649A373B03B9C3C618A0335:1:42BD90B66CFF, -1) AC44CBA7A291 @ 2024-04-23T20:06:16.200387Z}" proposer=BBD835B60F18426896E705A1DFD12444D4421C68
I[2024-04-23|20:17:27.113] received complete proposal block             module=consensus height=1 hash=6E5C9900BE599B3C0BAA73FCAAD238500B7645CEC649A373B03B9C3C618A0335
Executing Application ProcessProposal
Executing Application ExtendVote
I[2024-04-23|20:17:27.125] finalizing commit of block                   module=consensus height=1 hash=6E5C9900BE599B3C0BAA73FCAAD238500B7645CEC649A373B03B9C3C618A0335 root=0000000000000000 num_txs=0
Executing Application FinalizeBlock
I[2024-04-23|20:17:27.134] finalized block                              module=state height=1 num_txs_res=0 num_val_updates=0 block_app_hash=0000000000000000
I[2024-04-23|20:17:27.134] executed block                               module=state height=1 app_hash=0000000000000000
Executing Application Commit
&{0x14000506158 0 1}
I[2024-04-23|20:17:27.139] committed state                              module=state height=1 block_app_hash=0000000000000000
I[2024-04-23|20:17:27.150] indexed block events                         module=txindex height=1
I[2024-04-23|20:17:28.125] Timed out                                    module=consensus dur=981.123ms height=2 round=0 step=RoundStepNewHeight
Executing Application PrepareProposal
Processed vote extensions : map[bad:1 bloodmagic:1 cry:1 muggle:1 rain:1]
```

## Using the application

Let's try submitting a transaction to our new application. Open another terminal window and run the following `curl` command:

### Submit a tx with non curse word

```bash
curl -s 'localhost:26657/broadcast_tx_commit?tx="sender:Ron,message:Music"'
```

If everything went well, you should see a response indicating which height the transaction was included in the blockchain.

```bash
{"jsonrpc":"2.0","id":-1,"result":{"check_tx":{"code":0,"data":null,"log":"","info":"","gas_wanted":"0","gas_used":"0","events":[],"codespace":""},"tx_result":{"code":0,"data":null,"log":"","info":"","gas_wanted":"0","gas_used":"0","events":[],"codespace":""},"hash":"DD0DD9613C83E5CCDE31342DC49CEF1DD6423271B090BC6A73E800FD163E7ADD","height":"25"}}%
```

Let's make sure that transaction really was persisted by the application. Run the following command:

```bash
curl -s 'localhost:26657/abci_query?data="Ron"'
```

Let's examine the response object that this request returns. The request returns a `json` object with a `key` and `value` field set.

```bash
{
  "jsonrpc": "2.0",
  "id": -1,
  "result": {
    "response": {
      "code": 0,
      "log": "\"Music\"",
      "info": "",
      "index": "0",
      "key": "Um9u",
      "value": "Ik11c2ljIg==",
      "proofOps": null,
      "height": "0",
      "codespace": ""
    }
  }
}
```

Those values don't look like the key and value we sent to CometBFT. What's going on here?

The response contains a `base64` encoded representation of the data we submitted. To get the original value out of
this data, we can use the base64 command line utility:

```bash
echo Ik11c2ljIg== | base64 -d
```
As you can observe, **Music** was added, as message from Ron.

### Submit a tx with curse word

```bash
curl -s 'localhost:26657/broadcast_tx_commit?tx="sender:Malfoy,message:muggle"'
```

After a certain amount of time you will see a message that tx could not be included in the block. This happens as tx is being rejected in `PrepareProposal`

```bash
{"jsonrpc":"2.0","id":-1,"error":{"code":-32603,"message":"Internal error","data":"timed out waiting for tx to be included in a block"}}
```

Let's make sure that transaction really was not persisted by the application. Run the following command:

```bash
curl -s 'localhost:26657/abci_query?data="Malfoy"'
```

Let's examine the response object that this request returns. The request returns a `json` object with a `key` and `value` field set.

```bash
{
    "key": "TWFsZm95",
    "value": "Ik11Z2dsZSI=",
}
```

Again, you can see the original value using base64 command line utility

```bash
echo Ik11Z2dsZSI= | base64 -d
```

As you can observe, no message was added, since the user used a curse word.

### Submit a tx with non curse word for banned user

```bash
curl -s 'localhost:26657/broadcast_tx_commit?tx="sender:Malfoy,message:heroic"'
```

After a certain amount of time you will observe that tx was rejected in `checkTx` since the user has been already banned.

```bash
{"jsonrpc":"2.0","id":-1,"result":{"check_tx":{"code":3,"data":null,"log":"User is banned","info":"","gas_wanted":"0","gas_used":"0","events":[],"codespace":""},"tx_result":{"code":0,"data":null,"log":"","info":"","gasWanted":"0","gasUsed":"0","events":[],"codespace":""},"hash":"9B110D7648000037B8385562B15810C70E1957AF2F65790B3617CB84C9398536","height":"0"}}%
```

Our tutorial on building an ABCI 2 application using CometBFT has come to a close. We hope that the comprehensive tutorial
we provided has equipped you with the knowledge and skills necessary to develop your own applications with ease and confidence.
